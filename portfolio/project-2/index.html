<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <title>F1 Race Winner Predictor</title>

  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description"
    content="This is meta description.">
  
  <meta name="author" content="somrat">
  <meta name="generator" content="Hugo 0.101.0" />

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  
  <link rel="stylesheet" href="https://felipesanze.github.io/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,700,900&amp;display=swap">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
  
  <link rel="stylesheet" href="https://felipesanze.github.io/plugins/hover/hover.css">
  
  <link rel="stylesheet" href="https://felipesanze.github.io/plugins/magnific-popup/magnific-popup.css">
  
  <link rel="stylesheet" href="https://felipesanze.github.io/plugins/owl-carousel/owl.carousel.min.css">
  
  <link rel="stylesheet" href="https://felipesanze.github.io/plugins/owl-carousel/owl.theme.default.min.css">
  
  <link rel="stylesheet" href="https://felipesanze.github.io/plugins/text-animation/text-animation.css">
  

  
  
  <link rel="stylesheet" href="https://felipesanze.github.io/css/style.min.css" media="screen">

  
  
  <link rel="stylesheet" href="https://felipesanze.github.io/css/custom.min.css" media="screen">

  
  <link rel="shortcut icon" href="https://felipesanze.github.io/images/favicon.png" type="image/x-icon">
  <link rel="icon" href="https://felipesanze.github.io/images/favicon.png" type="image/x-icon">

  
  

  
  <meta property="og:image" content="https://felipesanze.github.io/images/portfolio/f1-ferrari.jpg" />
  
  <meta property="og:title" content="F1 Race Winner Predictor" />
<meta property="og:description" content="This is meta description." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://felipesanze.github.io/portfolio/project-2/" /><meta property="article:section" content="portfolio" />
<meta property="article:published_time" content="2022-08-20T12:14:34+06:00" />
<meta property="article:modified_time" content="2022-08-20T12:14:34+06:00" />


  

</head><body>
<!-- preloader start -->
<div class="preloader">
  
  <img src="https://felipesanze.github.io/images/preloader.gif" alt="preloader">
  
</div>
<!-- preloader end -->

<section class="menu menu-fix" id="home">
  <nav>
    
    <div class="menu-container menu-normal">
      <ul class="desktop-menu list-inline mb-0 justify-content-end" id="desktop-menu">
        <a class="mr-auto" href="https://felipesanze.github.io/">
          
          <img class="img-fluid" width="150px" src="https://felipesanze.github.io/images/logo-dark.png"
            alt="Felipe Sanz">
          
        </a>
        
        <li class="menu-item menu-item-transparent dark hvr-underline-from-left 1"><a href="https://felipesanze.github.io/">Home</a></li>
        
        <li class="menu-item menu-item-transparent dark hvr-underline-from-left 1"><a href="https://felipesanze.github.io#about">About me</a></li>
        
        <li class="menu-item menu-item-transparent dark hvr-underline-from-left 1"><a href="https://felipesanze.github.io#portfolio">Projects</a></li>
        
      </ul>
      
      
      

      
      <div class="mobile-menu">
        <a class="menu-link">
          <div class="mobile-menu-nav">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </a>
        <div class="mobile-menu-logo"><a href="https://felipesanze.github.io/"><img class="img-fluid"
              src="https://felipesanze.github.io/images/logo-dark.png" alt="Felipe Sanz"></a>
        </div>
        <div class="menu-slider">
          <nav>
            <ul class="mobile-menu-list">
              
              <li class="hvr-shutter-out-vertical mobile-menu-item 1"><a href="https://felipesanze.github.io/">Home</a></li>
              
              <li class="hvr-shutter-out-vertical mobile-menu-item 1"><a href="https://felipesanze.github.io#about">About me</a></li>
              
              <li class="hvr-shutter-out-vertical mobile-menu-item 1"><a href="https://felipesanze.github.io#portfolio">Projects</a></li>
              
            </ul>
            
            <ul class="mobile-menu-icons list-inline">
              
              <li><a href="https://github.com/felipesanze"><i class="fab fa-github"></i></a></li>
              
              <li><a href="https://www.linkedin.com/in/felipesanze/"><i class="fab fa-linkedin"></i></a></li>
              
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </nav>
</section>

<div style="height: 50px;"></div>


<style></style>
<section class="section " >
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mb-4 mb-lg-0">
        <div class="wow fadeInUp" data-wow-duration="1.5s">
          <img src="https://felipesanze.github.io/images/portfolio/f1-ferrari.jpg" alt="image" class="img-fluid w-100 mb-5">
          <div class="about-me-text mb-4">
            <h1>F1 Race Winner Predictor</h1>
          </div>
          <div class="content"><p><a href="https://github.com/felipesanze/F1_Race_Winner_Predictor" target="_blank" rel="noopener noreferrer">See code on GitHub</a></p>
<h2 id="overview">Overview</h2>
<ul>
<li><strong>Purpose:</strong> to develop a Machine Learning classification model that predicts the winner of each race of the 2021 season of Formula 1. Ultimately, have a robust model that can beat the odds in the upcoming seasons (despite the regulation changes of 2022)</li>
<li><strong>Data source:</strong> scraped from the <a href="https://www.formula1.com/">Formula 1 website</a> and the <a href="https://ergast.com/mrd/">Ergast F1</a> API.</li>
<li><strong>Modeling:</strong> built a tailor-made scoring function that evalueates predictions race after race and calculates a season-wide precision score. Used that score to compare and tune an <code>SVM</code>, a <code>Random Forest</code>, an <code>XGBoost</code>, and a <code>Logistic Regression</code>. <code>Neural networks</code> will be coming soon.</li>
<li><strong>Results:</strong> the model is able to predict the race winner with a <code>63%</code> presicion score. That translates into right above half the races correctly predicted.</li>
</ul>
<h2 id="1-data-collection">1. Data Collection</h2>
<p>Data was scraped from the <a href="https://www.formula1.com/">Formula 1 website</a> and the <a href="https://ergast.com/mrd/">Ergast F1</a> API. Scraped seasons from 1950 to 2021.
Used the Beautiful Soup and Selenium libraries to scrape the 7 dataframes used for this project: <code>Races</code>, <code>Rounds</code>, <code>Results</code>, <code>Driver Championships</code>, <code>Constructors Championships</code>, <code>Qualifying</code>, and <code>Weather</code>. They can all be found in the data folder.</p>
<h2 id="2-data-preprocessing">2. Data Preprocessing</h2>
<ul>
<li>Merged all DataFrames and dropped visibly redundant colums.</li>
<li>Replaced missing values of `qualifying_time&rsquo; by the average qualifying time for that team for that circuit. Missing values for points and position variables are assumed to be DNFs so they are replaced by 0.</li>
</ul>
<h3 id="21-feature-engineering">2.1. Feature Engineering</h3>
<ul>
<li><code>driver_age</code>: since race dates and driver birthdays are useless for our model, I decided to calculate the distant between the two and let driver age be a proxy for driver experience, which does affect likelihood of winning a race.</li>
<li><code>qualifying_time_delta</code>: since the absolute qualifying time can vary from circuit to circuit, I calculated a driver&rsquo;s time distance from the pole-sitter. This way quali time becomes comparable across circuits.</li>
<li><code>reg_era</code>: I bucketized the <code>season</code> variable into the different regulation eras in F1 history, as regulation changes can signify turning points for teams or drivers.</li>
<li><code>weather_wet</code>: wet conditions can have a significant impact in race results.</li>
</ul>
<h2 id="3-eda">3. EDA</h2>
<h3 id="31-feature-correlations">3.1. Feature Correlations</h3>
<p>Weather-related features are not very correlated with final race position. I will drop them all but &lsquo;weather_wet&rsquo; as I will use it for an analysis further down below.
<code>reg_era</code> could be a useful categorical variable for the modeling stage later. We must be careful with multicollinearity.
After dropping redundant columns the feature correlation matrix looks like this:</p>
<figure><img src="https://felipesanze.github.io/images/portfolio/correlation_matrix.png" width="800" height="700"/>
</figure>

<h3 id="32-circuits-where-qualifying-matters-the-most">3.2. Circuits where qualifying matters the most</h3>
<p>These are the 2021 circuits ranked by the correlation of final race position and qualifying position. We can see that even in the lower end of the list, qualifying position has a very significant correlaction with the race result. We can expect a high feature importance.
<figure><img src="https://felipesanze.github.io/images/portfolio/podium-grid_correlation.png" width="800" height="700"/>
</figure>
</p>
<h3 id="33-historic-performance-of-2021-constructors">3.3. Historic performance of 2021 constructors</h3>
<p>The purpose of this figure is not to have a precise histogram of race positions for every constructor. Instead, it aims to provide a smoothed view of the <strong>distribution</strong> of the historical race positions. This way, we can see that <strong>Mercedes</strong> has the heaviest skew, largelly due to them dominating during the <strong>V6 Hybrid</strong> era. On the other hand, an older team like <strong>Williams</strong> visibly has two modes that represent their golden days and their current back-marker performance. Team rebranding has been taken into account for <code>aston_martin</code>, <code>alpha_tauri</code> and <code>alpine</code>.
<figure><img src="https://felipesanze.github.io/images/portfolio/all_time_race_pos_by_constructor_2021.png" width="700" height="700"/>
</figure>
</p>
<h3 id="34-average-race-finish-position-wet-and-dry">3.4. Average race finish position (wet and dry)</h3>
<p>When it comes to overall driver performance, these are the top 10 drivers with the lowest all-time position average. Some things to point out:</p>
<ul>
<li>This is not far from the general public concensus of who the best drivers of all time are.</li>
<li>Hamilton has the lowest average position by a significant margin to Prost.</li>
<li>It is impressive how Max Verstappen takes the 4th spot this early in his career, over Michael Schumacher.</li>
</ul>
<figure><img src="https://felipesanze.github.io/images/portfolio/overall_driver_performance.png" width="300" height="400"/>
</figure>

<h3 id="35-performance-delta-of-wet-conditions">3.5. Performance delta of wet conditions</h3>
<p>I separated the metric in <code>3.4.</code> into performance in wet vs dry conditions and calculated the average positions gained (left, green) or lost (right, blue) by a given driver when racing in wet conditions (for top 20 dry-comditions drivers).</p>
<ul>
<li>Overall, good drivers tend to score high.</li>
<li>Good drivers in not so good cars benefit greatly from the rain. This is because drivers cannot go full push in the wet, making the difference in car performance smaller. This happened to George Russel in Spa in 2021, when he qualified 2nd with the slowest car&hellip; In the wet.</li>
</ul>
<figure><img src="https://felipesanze.github.io/images/portfolio/performance_delta_of_rain.png" width="800" height="700"/>
</figure>

<h2 id="4-modeling">4. Modeling</h2>
<p><strong>Target variable:</strong> <code>win</code> (i.e. did the driver win the race or not)</p>
<h3 id="41-main-challenge">4.1. Main challenge</h3>
<p>The main modeling challenge in this case is that the model will not predict the winner of each race if I pass it the entire dataset from 1950 to 2021. What we need it to do is to only see one race at a time and predict the winner. For this I needed a custom made scoring and predicting function that processes race per race in batches.<br>
This also adds a layer of complexity to the model tunning process the evaluation of my results.</p>
<h3 id="42-prediction-and-scoring">4.2. Prediction and scoring</h3>
<p>For a given race:</p>
<ul>
<li>I run a classifier to predict the probability of winning for each driver</li>
<li>Sort the predicted values in descending order of win probability</li>
<li>Map the top driver to win = 1 and the rest to win = 0</li>
<li>Calculate the race score as the &lsquo;precision_score` of that race
Model score:</li>
<li>Model score is the (sum of precision_score of all races) / (number of races in the test season). In other words, the average race precision score.</li>
</ul>
<h3 id="43-feature-importance">4.3. Feature importance</h3>
<ul>
<li>It makes sense that the qualifying result (&lsquo;grid&rsquo;) be disproportionately more important than other features because it is the closest event to the actual race, specially in circuits where overtaking is more difficult. It is an indication of a driver&rsquo;s performance in &rsquo;lab conditions&rsquo;, without attacking, deffending, or managing tyres.</li>
<li>The accumulated constructor and driver points are an indication of how likely is this driver to win given its positions in the past races of the season. They contain the year-to-date performance of a driver/constructor in a single number.</li>
<li>Similarly, the driver&rsquo;s age is a proxy for their tenure or experience in F1 (the two are extremely correlated). It is the all-time hisory of the driver.</li>
<li>Weather_wet turned out to be way less important than expected.</li>
</ul>
<figure><img src="https://felipesanze.github.io/images/portfolio/feature_importance_mdi.png" width="800" height="700"/>
</figure>

<h3 id="44-results">4.4. Results</h3>
<p>The model is able to predict the race winner with a <code>63%</code> presicion score. That translates into right above half the races correctly predicted. I do not recommend to use this model for betting purposes beyond the 2021 season. F1 regulations have suffered significant changes that make it unlikely that this model perform well from 2022 onwards. I will revisit it after the 2022 season ends to evaluate that possibility.</p>
<h2 id="5-next-steps">5. Next Steps</h2>
<ul>
<li>Put it all into production: create an automated web interface where, right after qualifying on Saturday, the user presses a button, the fresh data gets scraped and ran through the model. The user will get an expected winner for the race of that weekend. Just for the fun of it&hellip;</li>
<li>While estimating the probability of winning, we set teh driver with the higest probability as the winner. What if we calculate the percentage difference between the predicted winner and the predicted P2? This could give us a sense of how certain the model is about its prediction for a given race.</li>
<li>Using a GPU, build a Neural Network to hopefully improve the quality of our predictions.</li>
<li>Use Variance Inflation Factor (VIF) to check for multicollinearity.</li>
</ul>
<p><a href="https://github.com/felipesanze/F1_Race_Winner_Predictor" target="_blank" rel="noopener noreferrer">See code on GitHub</a></p>
</div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="bg-white sticky-top wow fadeInUp" data-wow-duration="1.5s" style="top: 80px;">
          <ul class="list-unstyled">
            <li class="media mb-4">
              <i class="mt-1 fas fa-calendar h2"></i>
               <div class="ml-3">
                 <h4>Date</h4>
                 <div class="content">20 Aug, 2022</div>
               </div>
             </li>
             <li class="media mb-4">
               <i class="mt-1 fas fa-folder h2"></i>
                <div class="ml-3">
                  <h4>Categories</h4>
                  <div class="content"> Personal Project, Supervised Learning, Classification</div>
                </div>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>


	<footer class="footer-bg fadeInUp wow" data-wow-duration="1.5s">
  <div class="container">
    <div class="row">
      <div class="footer col-lg-10 offset-lg-1">
        <hr>
        <ul class="footer-icons list-inline">
          
          <li><a href="https://github.com/felipesanze"><i class="fab fa-github"></i></a></li>
          
          <li><a href="https://www.linkedin.com/in/felipesanze/"><i class="fab fa-linkedin"></i></a></li>
          
        </ul>
        <div class="to-top">
          <a href="#home"><i class="fa fa-chevron-up"></i></a>
        </div>
        <div class="credit content">
          Copyright Â© 2020 a hugo theme by <a href="https://somrat.netlify.com">somrat</a>
        </div>
      </div>
    </div>
  </div>
</footer><!-- JS Plugins -->

<script src="https://felipesanze.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://felipesanze.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://felipesanze.github.io/plugins/wow.min.js"></script>

<script src="https://felipesanze.github.io/plugins/text-animation/text-animation.js"></script>

<script src="https://felipesanze.github.io/plugins/jquery.waypoints.min.js"></script>

<script src="https://felipesanze.github.io/plugins/shuffle/shuffle.min.js"></script>

<script src="https://felipesanze.github.io/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>

<script src="https://felipesanze.github.io/plugins/owl-carousel/owl.carousel.min.js"></script>


<!-- Main Script -->

<script src="https://felipesanze.github.io/js/script.min.js"></script>

<!-- google analitycs -->
</body>

</html>